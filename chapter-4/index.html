<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chapter 2 ‚Äì Reader</title>
  <style>
    :root { --bg:#0f1115; --fg:#f2f2f2; --muted:#98a2b3; --zoom:1; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);
         font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    .bar{position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:.5rem;
         padding:.6rem .8rem;background:#151821cc;backdrop-filter:blur(8px);
         border-bottom:1px solid #232836}
    .title{font-weight:700;letter-spacing:.3px;margin-right:auto}
    .btn,.num{background:#1a1f2b;color:var(--fg);border:1px solid #2a3142;
         border-radius:10px;padding:.45rem .7rem;font:inherit;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .num{width:5.2rem;text-align:center}
    .wrap{max-width:1000px;margin:0 auto;padding:1rem .8rem 3rem}
    .page{position:relative;margin:0 auto 1.1rem;transform:scale(var(--zoom));
          transform-origin:top center;transition:transform .15s ease}
    .page img{width:100%;height:auto;display:block;border-radius:8px;
              background:#0c0f14;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .page .tag{position:absolute;right:10px;bottom:10px;background:rgba(0,0,0,.55);
               color:#fff;font-size:12px;padding:.15rem .4rem;border-radius:6px}
    .muted{color:var(--muted)}
    .sep{width:1px;height:28px;background:#2a3142;margin:0 .4rem}
    .hide{display:none!important}
    .light{ --bg:#ffffff; --fg:#101418; --muted:#4b5563 }
  </style>
</head>
<body>
  <div class="bar">
    <div class="title">Chapter 2</div>
    <button class="btn" id="prev">‚Üê Prev</button>
    <label class="muted">Page</label>
    <input class="num" id="go" type="number" min="1" value="1">
    <span class="muted">/ <span id="total">8</span></span>
    <button class="btn" id="next">Next ‚Üí</button>
    <div class="sep"></div>
    <button class="btn" id="fit">Fit</button>
    <button class="btn" id="zin">+</button>
    <button class="btn" id="zout">‚àí</button>
    <button class="btn" id="mode">üåô/‚òÄÔ∏è</button>
  </div>
  <div id="pages" class="wrap" aria-live="polite"></div>
  <script>
  (function(){
    const DIR = "images/";
    const TOTAL = 8;

    const pagesEl = document.getElementById("pages");
    for (let i = 1; i <= TOTAL; i++) {
      const p = document.createElement("div");
      p.className = "page";
      p.dataset.page = i;

      const filename = i === 1 
        ? "CH4.jpg" 
        : `CH4_${String(i - 1).padStart(2, "0")}.jpg`;

      const img = document.createElement("img");
      img.alt = `Page ${i}`;
      img.loading = "lazy";
      img.decoding = "async";
      img.dataset.src = DIR + filename;
      img.onerror = () => p.classList.add("hide");

      const tag = document.createElement("div");
      tag.className = "tag";
      tag.textContent = i;

      p.appendChild(img);
      p.appendChild(tag);
      pagesEl.appendChild(p);
    }

    const io = new IntersectionObserver(entries => {
      entries.forEach(e => {
        const img = e.target.querySelector("img");
        if (e.isIntersecting && img && !img.src) {
          img.src = img.dataset.src;
          io.unobserve(e.target);
        }
      });
    }, { rootMargin: "800px 0px" });

    document.querySelectorAll(".page").forEach(p => io.observe(p));

    let current = 1, zoom = 1;
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
    const go = document.getElementById("go");

    function setZoom(z) {
      zoom = clamp(z, 0.6, 2.5);
      document.documentElement.style.setProperty("--zoom", zoom);
    }

    function scrollToPage(n) {
      current = clamp(n, 1, TOTAL);
      go.value = current;
      const el = document.querySelector(`.page[data-page="${current}"]`);
      if (el) window.scrollTo({ top: el.offsetTop - 70, behavior: "smooth" });
    }

    document.getElementById("prev").onclick = () => scrollToPage(current - 1);
    document.getElementById("next").onclick = () => scrollToPage(current + 1);
    document.getElementById("zin").onclick = () => setZoom(zoom + 0.15);
    document.getElementById("zout").onclick = () => setZoom(zoom - 0.15);
    document.getElementById("fit").onclick = () => {
      const first = document.querySelector(".page img");
      if (!first || !first.naturalWidth) return setZoom(1);
      const need = pagesEl.clientWidth / first.naturalWidth;
      setZoom(need);
    };
    document.getElementById("mode").onclick = () =>
      document.body.classList.toggle("light");
    go.onchange = () => scrollToPage(parseInt(go.value || "1", 10));

    const spy = new IntersectionObserver(es => {
      es.forEach(e => {
        if (e.isIntersecting) {
          current = parseInt(e.target.dataset.page, 10);
          go.value = current;
        }
      });
    }, { rootMargin: "-40% 0px -55% 0px" });
    document.querySelectorAll(".page").forEach(p => spy.observe(p));

    window.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft") scrollToPage(current - 1);
      if (e.key === "ArrowRight") scrollToPage(current + 1);
      if (e.key === "+") setZoom(zoom + 0.15);
      if (e.key === "-") setZoom(zoom - 0.15);
      if (e.key.toLowerCase() === "f") document.getElementById("fit").click();
    });

    go.value = 1;
    setZoom(1);
  })();
  </script>
  <div style="text-align:center; margin-top: 3rem;">
  <a href="../chapter-1/" style="color: #aaa; text-decoration: none; margin-right: 1rem;">‚Üê Back to Chapter 1</a>
  <a href="../chapter-3/" style="
    display: inline-block;
    padding: 0.8rem 1.5rem;
    background-color: #1a1c22;
    color: #f2f2f2;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    transition: background 0.3s ease;
  " onmouseover="this.style.background='#2a2d36'" onmouseout="this.style.background='#1a1c22'">
    Next Chapter ‚Üí
  </a>
</div>
</body>
</html>
